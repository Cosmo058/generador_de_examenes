<!DOCTYPE html>
<html>
  <head>
    <title>Generador de ex&aacute;menes</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="assets/css/style.css">
    <link rel="stylesheet" type="text/css" media="print"  href="assets/css/style_print.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="assets/js/html2canvas.js"></script>
    <script src="assets/js/html2pdf.js"></script>
    <script src="assets/js/funciones.js"></script>
    <script src="assets/js/controller.js"></script>
    

    <script>
      $(document).keypress(function(e) { //EventListener DEBUG
	if(e.which === 13) {
	  $("#examen_html").addClass("collapsed");
	  $("#examen_html span").removeClass("collapsed");
	  //window.print();
	}
      });
      
      $(document).ready(function(){
	
	init(); //Poblar el DOM con los AE, reactivos y respuestas (mediante AJAX)
	
	$(document).ajaxComplete(function(){
	  centrar_tarjetas();
	  igualar_altura_logos();
	
	  //Go to reactivos (Page2)
	  $('#ae_container .card').click(function(){
	    var text = $(this).find(".card_content").html();
	    var idAE = $(this).attr("idAE");
	    $("#ae_container").toggle();
	    $("#title").toggle();
	    $("#ae_seleccionado").toggleClass("collapsed col-md-2");
	    $("#ae_sub").toggleClass("collapsed col-md-10");
	    
	    $("#reactivos").removeClass("collapsed");
	    $("#reactivos").addClass("col-md-12");
	    
	    $("#ae_seleccionado > div:not(.circle)").html(text);
	    
	    $(".card2").each(function(index){
	      if( $(this).attr("idAE") === idAE ){
		$(".card2[idAE="+$(this).attr("idAE")+"]").removeClass("collapsed");
	      }
	    });
	  });
	  
	   //Back to AE (Page1)
	  $("#back_to_AE").click(function(){
	    $("#ae_container").toggle();
	    $("#title").toggle();
	    $("#ae_seleccionado").toggleClass("col-md-2 collapsed");
	    $("#ae_sub").toggleClass("col-md-10 collapsed");
	    
	    $("#reactivos").addClass("collapsed");
	    $("#reactivos").removeClass("col-md-8");
	    $("#reactivos").addClass("col-md-12");
	    $("#preview_reactivo").addClass("collapsed");
	    $("#lista_final").addClass("collapsed");
	    
	    $(".card2").each(function(index){ //Hide all card2
	      $(this).addClass("collapsed");
	    });
	  });

	  //Mostrar el preview de las respuestas
	  $(".pregunta_div").click(function(){
	    $("#reactivos").toggleClass("col-md-12 col-md-8");
	    $("#preview_reactivo").toggleClass("collapsed col-md-4");
	    
	    var idAE = $(this).parent().parent().attr("idAE");
	    var idReactivo = $(this).parent().parent().attr("idReactivo");
	    
	    //alert(idAE+"_"+idReactivo);
	    
	    $("#preview_reactivo span").each(function(){
	      //alert( $(this).attr("idAE")+"_"+$(this).attr("idReactivo") );
	      if( $(this).attr("idAE") === idAE && $(this).attr("idReactivo") === idReactivo ){
		$(this).removeClass("collapsed");
	      }else{
		$(this).addClass("collapsed");
	      }
	    });
	  });

	  //Evento de clicks en los checkbox
	  $("input").click(function(){
	    $(this).siblings("label").toggleClass("red_background");
	    $("#num_reactivos").html($("input:checkbox:checked").length+" reactivos elegidos");
	    
	    $("#contador_a_preview .col-md-5").html($("input:checkbox:checked").length+" reactivos elegidos</div>");
	    $("#contador_a_preview").removeClass("collapsed");
	  });
	  
	  //Go to the final questions' preview (Page3)
	  $("#go_to_preview").click(function(){
	    $("#ae_container").toggle();
	    $("#title").toggle();
	    $("#ae_seleccionado").toggleClass("collapsed col-md-2");
	    $("#ae_sub").toggleClass("collapsed col-md-10");
	    
	    $("#reactivos").addClass("collapsed");
	    $("#preview_reactivo").removeClass("collapsed");
	    $("#preview_reactivo").addClass("col-md-4");
	    $("#lista_final").removeClass("collapsed");
	    
	    $("#ae_seleccionado > div:not(.circle)").html("Reactivos seleccionados");
	    
	    seleccionados_a_preview();
	    
	    mostrar_preview_respuestas("no_toggle");
	    
	  });
	}); //End of AjaxCallCompleted
	
        $(window).resize(function(){
          centrar_tarjetas();
          igualar_altura_logos();
        });
      });
    </script>
  </head>

  <body>
    <div class="container">

      <!-- Header -->
      <div class="row" id="header">
        <div class="col-md-2" id="logo_castillo_container">
            <img src="assets/img/logo/logo_castillo.png" alt="logo_castillo">
        </div>
        <div class="col-md-7"></div>
        <div class="col-md-3">
          <div id="materia_section">
            <div id="materia_title">
              <span>Biolog&iacute;a</span>
            </div>
            <div style="margin-left: 110px;">  <!-- TODO -->
              <div id="logo_reactivos">
                <img src="assets/img/reactivos_seleccionados.png">
              </div>
              <div id="num_reactivos">0 reactivos elegidos</div>
            </div>
          </div>
        </div>
      </div>
     <!--/Header-->

     <!--Title-->
     <div class="row" id="title">
       <div class="col-md-8" id="texto">
          <h3>Generador de ex&aacute;menes</h3>
          <p>Aprendizajes esperados</p>
        </div>
       <div class="col-md-4 collapsed" id="contador_a_preview">
	 <div class="row">
	  <div class='col-md-5' style='margin-top:2px;'></div>
	  <div class="col-md-2" style="margin-left: -30px">
	    <div class='circle' id='go_to_preview'>
	      <button class='arrow'>
		<svg viewBox='-18 0 100 80' xml:space='preserve'>
		  <polyline points='0.375,0.375 45.63,38.087 0.375,75.8'/>
		</svg>
	      </button>
	    </div>
	  </div>
	 </div>
	</div>
      </div>
      <!--/Title-->

      <!--Main content-->
      <div class="row" id="main_content">
        <!--Cards-->
        <div class="col-md-12" id="ae_container"></div>
        <!--/Cards-->
        <div class="collapsed" id="ae_seleccionado"> <!-- col-md-2 -->
          <div id="sidebar_text">
          </div>
          <div class="circle" id="back_to_AE">
            <button class="arrow">
              <svg viewBox="-5 0 100 80" xml:space="preserve">
                <polyline points="45.63,75.8 0.375,38.087 45.63,0.375"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="collapsed" id="ae_sub">
          <div class="row">
            <div class="col-md-12 collapsed" id="reactivos"> <!-- col-md-10 --></div>
	    <div class="col-md-8 collapsed" id="lista_final">COSAS</div>
            <div class="collapsed" id="preview_reactivo"></div>
          </div>
        </div>
      </div>
      <!--/Main content-->

      <!--Footer-->
      <div class="row">
        <div class="col-md-12" id="footer">
          D.R. &copy; 2017 | Ediciones Castillo, S.A. de C.V. <br/>
          TODOS LOS DERECHOS RESERVADOS
        </div>
      </div>
      <!--/Footer-->
      
      <div class="row">
	<div class="col-md-12" id="examen_html"></div>
      </div>
    </div>
  </body>
</html>
